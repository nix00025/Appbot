<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Applyze Recruiting Bot</title>
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet" />
  <style>
    :root{
      --brand:#0c4bfa;
      --ink:#222;
      --paper:rgba(255,255,255,.96);
      --soft:rgba(0,0,0,.18);
      --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      font-family:"Poppins",system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
      margin:0;
      background:none;
      color:var(--ink);
    }
    /* subtle gradient veil to improve text readability over bg */
    body::before{content:"";}

    /* Info cards */
    .info-box{
      position:fixed;width:min(340px,92vw);max-width:92vw;
      background:var(--paper);backdrop-filter:blur(6px);
      border-radius:var(--radius);padding:18px 20px;box-shadow:0 6px 18px var(--soft);
    }
    .info-box h3{margin:0 0 6px;color:var(--brand);letter-spacing:.5px}
    .info-box p{margin:0;font-size:14px;line-height:1.6}
    .mission{top:16px;left:16px}
    .vision{bottom:16px;left:16px}

    /* Chat */
    .chatbot{position:fixed;bottom:86px;right:20px;width:360px;max-width:94vw;max-height:70vh;display:flex;flex-direction:column;overflow:hidden;border-radius:22px;background:#fff;box-shadow:0 10px 30px rgba(0,0,0,.3)}
    .chatbot[hidden]{display:none}
    .chat-header{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;background:var(--brand);color:#fff;font-weight:600}
    .chat-header .title{display:flex;gap:8px;align-items:center}
    .chat-header button{appearance:none;border:0;background:transparent;color:#fff;font-size:18px;cursor:pointer}
    .chat-messages{flex:1;overflow:auto;padding:10px;scroll-behavior:smooth;background:linear-gradient(#fff,#fbfbff)}
    .msg{margin:6px 0;max-width:85%;line-height:1.5;font-size:14px}
    .msg.bot{background:#f2f5ff;border:1px solid #e0e6ff;color:#111;padding:8px 10px;border-radius:12px}
    .msg.user{background:#eef3ff;border:1px solid #cfdcff;color:#0c4bfa;margin-left:auto;padding:8px 10px;border-radius:12px}

    .options{display:flex;flex-wrap:wrap;gap:6px;margin:6px 0}
    .option{appearance:none;border:1px solid #ccd4ff;background:#f7f8ff;padding:6px 10px;border-radius:8px;cursor:pointer;transition:transform .08s ease}
    .option:hover{transform:translateY(-1px);background:#eef2ff}

    .chat-input{display:flex;gap:6px;border-top:1px solid #eee;padding:8px}
    .chat-input input{flex:1;border:1px solid #ddd;border-radius:10px;padding:10px;font:inherit;outline:none}
    .chat-input button{background:var(--brand);border:0;color:#fff;border-radius:10px;padding:10px 14px;cursor:pointer;font-weight:600}

    /* FAB */
    #toggleChat{position:fixed;bottom:20px;right:20px;width:60px;height:60px;border-radius:50%;border:0;background:var(--brand);color:#fff;font-size:28px;cursor:pointer;box-shadow:0 6px 16px rgba(0,0,0,.35)}
    #toggleChat .ping{position:absolute;top:6px;right:8px;width:10px;height:10px;background:#ff5252;border-radius:50%}

    /* Modal */
    dialog{border:0;border-radius:14px;width:min(520px,94vw);padding:0;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .modal-head{padding:14px 18px;background:var(--brand);color:#fff;font-weight:600}
    .modal-body{padding:16px}
    .modal-actions{display:flex;gap:8px;justify-content:flex-end;padding:12px 16px;border-top:1px solid #eee}
    .btn{appearance:none;border:1px solid #d4d7e5;background:#fff;color:#222;padding:8px 12px;border-radius:10px;cursor:pointer}
    .btn.primary{background:var(--brand);border-color:var(--brand);color:#fff}

    /* Responsive: tuck info cards on small screens */
    @media (max-width: 840px){
      .mission,.vision{position:static;margin:10px auto;display:block}
      body{padding:10px}
      .chatbot{bottom:96px}
    }
  .video-bg{position:fixed;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:-1;}


@media (max-width: 900px){.mascot{display:none}}
@keyframes neonPulse{0%{transform:scale(.9);}50%{transform:scale(1.15);}100%{transform:scale(.9);}}
</style>
</head>
<body>
  <!-- Background Video -->
  <!-- Background Video -->
  <video class="video-bg" autoplay muted loop playsinline>
    <source src="INNOV 2.mp4" type="video/mp4">
  </video>
  
  
  
  <!-- Mission -->
  
  <!-- Vision -->
  

  <!-- FAB (unread dot appears on first load) -->
  <button id="toggleChat" aria-controls="chatBot" aria-expanded="false" title="Open chat">
    üí¨<span class="ping" aria-hidden="true"></span>
  </button>

  <!-- Chat Window -->
  <section class="chatbot" id="chatBot" hidden aria-live="polite">
    <header class="chat-header">
      <div class="title" role="heading" aria-level="1">Recruiting Bot</div>
      <div>
        <button id="minimizeBtn" aria-label="Minimize">‚ñÅ</button>
        <button id="closeChat" aria-label="Close">‚úñ</button>
      </div>
    </header>
    <div class="chat-messages" id="messages"></div>
    <div class="chat-input">
      <input id="userInput" type="text" inputmode="text" autocomplete="off" placeholder="Type here‚Ä¶" aria-label="Type a message" />
      <button id="sendBtn" type="button">Send</button>
    </div>
  </section>

  <!-- Privacy modal (optional long text) -->
  <dialog id="privacyModal">
    <div class="modal-head">Data Privacy Consent Policy</div>
    <div class="modal-body">
      <p style="margin-top:0">We collect your name, contact details, and application information for recruitment purposes, in accordance with applicable privacy laws. Your data will be used only to evaluate your application and schedule interviews, and retained for a limited period. You may request access, correction, or deletion by contacting HR.</p>
      <p>By selecting <b>Yes</b>, you consent to this processing.</p>
    </div>
    <div class="modal-actions">
      <button class="btn" data-close>No</button>
      <button class="btn primary" data-accept>Yes, I Agree</button>
    </div>
  </dialog>

  <script>
    // ====== CONFIG ======
    const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwRJ28qiS_TBdFNyqLkLXBLV6Dz2CzIPrn7-nLSWry6b6jyzM6zTZdoEmNFmzxs1x73SA/exec"; // keep as-is or replace
    const LOCALE_DEFAULT = 'en';

    // ====== STATE ======
    let step = 0; // flow controller
    let applicant = {}; // collected data

    const messagesEl = document.getElementById('messages');
    const inputEl = document.getElementById('userInput');

    // ====== UTIL ======
    const showMessage = (html, who = 'bot') => {
      const div = document.createElement('div');
      div.className = `msg ${who}`;
      div.innerHTML = html;
      messagesEl.appendChild(div);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    };

    const showOptions = (arr) => {
      const wrap = document.createElement('div');
      wrap.className = 'options';
      arr.forEach(label => {
        const b = document.createElement('button');
        b.className = 'option';
        b.type = 'button';
        b.textContent = label;
        b.addEventListener('click', () => handleResponse(label));
        wrap.appendChild(b);
      });
      messagesEl.appendChild(wrap);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    };

    const isEmail = (v) => /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(v.trim());
    const isPhone = (v) => /^(\+?\d[\d\s-]{7,})$/.test(v.trim());

    const todayLocalISO = () => {
      // force Asia/Manila minimum date regardless of user machine tz
      try{
        const now = new Date();
        const manilaOffsetMinutes = 8 * 60; // UTC+8
        const utc = now.getTime() + now.getTimezoneOffset()*60000;
        const manila = new Date(utc + manilaOffsetMinutes*60000);
        return manila.toISOString().split('T')[0];
      }catch(e){
        return new Date().toISOString().split('T')[0];
      }
    };

    const persist = async (payload) => {
      try{
        const res = await fetch(APPS_SCRIPT_URL, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
        // Optionally read text for debug
        // const t = await res.text(); console.log(t);
        return res.ok;
      }catch(err){
        console.error(err);
        return false;
      }
    };

    const rejectApplicant = async (reason = 'Did not pass initial screen') => {
      applicant.status = 'Rejected';
      applicant.reason = reason;
      await persist(applicant);
      showMessage("Thank you for participating in our initial screening process. Unfortunately, our screening suggests that you may not be the best fit for this position at this time.<br><br>We are moving forward with another candidate whose background matches the current needs of the role. We encourage you to apply again in the future.");
      step = 999;
    };

    const showSummary = async () => {
      const summary = `
        <b>Summary</b><br>
        ‚Ä¢ Name: ${applicant.name}<br>
        ‚Ä¢ Contact: ${applicant.contact}<br>
        ‚Ä¢ Email: ${applicant.email}<br>
        ‚Ä¢ Address: ${applicant.address}<br>
        ‚Ä¢ Education: ${applicant.education}<br>
        ‚Ä¢ HR Exp: ${applicant.hrExp}<br>
        ‚Ä¢ Admin Exp: ${applicant.adminExp}<br>
        ‚Ä¢ Skills: ${applicant.skills}<br>
        ‚Ä¢ Interview Schedule: ${applicant.date} ${applicant.time}
      `;
      showMessage(summary);
      applicant.status = 'For Interview';
      await persist(applicant);
      showMessage('‚úÖ Your interview has been scheduled successfully! You and HR will receive an email confirmation.');
      step = 999;
    };

    // ====== FLOW HANDLER ======
    const handleResponse = (input) => {
      const val = typeof input === 'string' ? input : (inputEl.value || '').trim();
      if (!val) return;

      // echo user
      if (typeof input === 'string') {
        showMessage(val, 'user');
      } else {
        showMessage(val, 'user');
        inputEl.value = '';
      }

      switch(step){
        case 0: {
          showMessage('Please select your language / Piliin ang iyong wika:');
          showOptions(['English','Tagalog']);
          step = 1; break;
        }
        case 1: {
          applicant.language = val;
          showMessage('Do you agree to our Data Privacy Consent Policy? <button class="option" type="button" id="openPrivacy">Read Policy</button>');
          showOptions(['Yes','No']);
          // attach open modal
          setTimeout(()=>{
            const btn = document.getElementById('openPrivacy');
            if(btn) btn.addEventListener('click', ()=> document.getElementById('privacyModal').showModal());
          },0);
          step = 2; break;
        }
        case 2: {
          if (val === 'No') { rejectApplicant('Declined privacy consent'); return; }
          applicant.consent = 'Yes';
          showMessage('What is your First and Last Name?');
          step = 3; break;
        }
        case 3: {
          applicant.name = val;
          const first = val.split(/\s+/)[0] || 'there';
          showMessage(`Hi ${first}! Please enter your contact number.`);
          step = 4; break;
        }
        case 4: {
          if (!isPhone(val)) { showMessage('‚ö†Ô∏è Please enter a valid contact number (digits only, may include +).'); return; }
          applicant.contact = val;
          showMessage('Please enter your email address.');
          step = 5; break;
        }
        case 5: {
          if (!isEmail(val)) { showMessage('‚ö†Ô∏è That email looks invalid. Please try again.'); return; }
          applicant.email = val;
          showMessage('Please enter your address.');
          step = 6; break;
        }
        case 6: {
          applicant.address = val;
          showMessage('Select your Educational Attainment:');
          showOptions(['Elementary','High School Graduate','College Undergraduate','College Graduate']);
          step = 7; break;
        }
        case 7: {
          applicant.education = val;
          if (val === 'Elementary') { rejectApplicant('Below minimum education requirement'); return; }
          showMessage('How long do you have relevant experience with HR work?');
          step = 9; break;
        }
        case 9: {
          applicant.hrExp = val;
          showMessage('How long do you have relevant experience with Administrative work?');
          step = 10; break;
        }
        case 10: {
          applicant.adminExp = val;
          showMessage('Please enumerate your skills or certifications (N/A if none).');
          step = 11; break;
        }
        case 11: {
          applicant.skills = val;
          showMessage('Please select your preferred interview date:');
          const dateInput = document.createElement('input');
          dateInput.type = 'date';
          dateInput.min = todayLocalISO();
          dateInput.addEventListener('change', (e)=> handleResponse(e.target.value));
          messagesEl.appendChild(dateInput);
          messagesEl.scrollTop = messagesEl.scrollHeight;
          step = 12; break;
        }
        case 12: {
          applicant.date = val;
          showMessage('Please select your preferred interview time:');
          const timeInput = document.createElement('input');
          timeInput.type = 'time';
          timeInput.required = true;
          timeInput.addEventListener('change', (e)=> handleResponse(e.target.value));
          messagesEl.appendChild(timeInput);
          messagesEl.scrollTop = messagesEl.scrollHeight;
          step = 13; break;
        }
        case 13: {
          applicant.time = val;
          showSummary();
          break;
        }
        default:
          // Do nothing if flow finished
          break;
      }
    };

    // ====== WIRING ======
    document.getElementById('sendBtn').addEventListener('click', ()=> handleResponse());
    inputEl.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); handleResponse(); }});

    const fab = document.getElementById('toggleChat');
    const chat = document.getElementById('chatBot');
    const closeBtn = document.getElementById('closeChat');
    const minimizeBtn = document.getElementById('minimizeBtn');

    const openChat = () => { chat.hidden = false; fab.setAttribute('aria-expanded','true'); fab.querySelector('.ping')?.remove(); };
    const closeChat = () => { chat.hidden = true; fab.setAttribute('aria-expanded','false'); };

    fab.addEventListener('click', ()=> chat.hidden ? openChat() : closeChat());
    closeBtn.addEventListener('click', closeChat);
    minimizeBtn.addEventListener('click', ()=> chat.style.maxHeight = chat.style.maxHeight ? '' : '46px');

    // Privacy modal controls
    const privacyModal = document.getElementById('privacyModal');
    privacyModal?.querySelector('[data-close]')?.addEventListener('click', ()=>{ privacyModal.close(); handleResponse('No'); });
    privacyModal?.querySelector('[data-accept]')?.addEventListener('click', ()=>{ privacyModal.close(); handleResponse('Yes'); });

    // ====== INIT ======
    showMessage('Welcome to Applyze Recruiting Bot! Click below to start.');
    showOptions(['Start']);
  </script>
</body>
</html>
